"use strict";(()=>{(function(){"use strict";let i=window.ZaaNetConfig,l=i.getApiConfig(),v=document.getElementById("voucherForm"),u=document.getElementById("voucherCode"),p=document.getElementById("submitBtn"),m=document.getElementById("message"),h=document.getElementById("debugPanel"),C=document.getElementById("debugRouterID"),N=document.getElementById("debugMAC"),T=document.getElementById("debugIP"),b=document.getElementById("debugEnv"),d=new URLSearchParams(window.location.search),P=d.get("tok")||"$tok",$=d.get("redir")||"$redir",S=d.get("mac")||d.get("clientmac")||"$clientmac",k=d.get("ip")||d.get("clientip")||"$clientip",I=R(S,O()),E=R(k,F()),L=document.querySelector('meta[name="router-id"]')?.content||"UNKNOWN",y=document.querySelector('meta[name="contract-id"]')?.content||"UNKNOWN";if(!v||!u||!p||!m){console.error("[ZaaNet] Required DOM elements not found");return}M();async function M(){if(r("Initializing ZaaNet Splash Page..."),r("Environment:",i.environment),r("API Base URL:",l.baseUrl),i.features.showDebugPanel&&h?(h.style.display="block",C&&(C.textContent=L),N&&(N.textContent=I),T&&(T.textContent=E),b&&(b.textContent=i.environment)):h&&(h.style.display="none"),y&&y!=="UNKNOWN")try{await H(y)}catch(e){r("Failed to load network info:",e)}B(),u?.focus()}function B(){i.features.autoFormatVoucher&&u&&u.addEventListener("input",x),v&&v.addEventListener("submit",U)}function x(e){let n=e.target,t=n.value.toUpperCase();t=t.replace(/[^A-Z0-9]/g,"");let s=[];s.push(i.voucher.prefix),t.startsWith(i.voucher.prefix)&&(t=t.substring(i.voucher.prefix.length));for(let a=0;a<i.voucher.segments;a++){let c=a*i.voucher.segmentLength,o=t.substring(c,c+i.voucher.segmentLength);o&&s.push(o)}n.value=s.join(i.voucher.separator)}async function U(e){if(e.preventDefault(),!u)return;let n=u.value.trim();if(!n){g("Please enter a voucher code","error");return}r("Validating voucher:",n),w(!1,"Validating..."),g("Validating your voucher...","info");try{let t=await V(n);if(!t.isValid){g(t.error||"Invalid voucher code","error"),w(!0,"Connect to Internet");return}r("Voucher valid!",t),g("Voucher valid! Starting session...","success");let s=await j(n,y,E,I);if(s.success&&s.sessionId&&s.contractId)g("Success! Loading your session...","success"),setTimeout(()=>{let a=s.sessionId||"",c=s.contractId||"",o=`session.html?sessionId=${encodeURIComponent(a)}&contractId=${encodeURIComponent(c)}&mac=${encodeURIComponent(I)}&ip=${encodeURIComponent(E)}`;r("Redirecting to session dashboard:",o),window.location.href=o},i.ui.redirectDelay);else throw new Error(s.message||"Failed to start session")}catch(t){r("Error:",t),g("Connection error. Please try again.","error"),w(!0,"Connect to Internet")}}async function V(e){let n=`${l.baseUrl}${l.validateEndpoint}`;r("POST",n);let t=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({voucherCode:e})});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);return await t.json()}async function H(e){let n=`${l.baseUrl}${l.networkInfoEndpoint}/${e}`;r("GET",n);try{let t=await fetch(n,{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);let s=await t.json();s.success&&s.networkData&&A(s.networkData)}catch(t){r("Error loading network info:",t)}}function A(e){let n=document.getElementById("networkName");n&&(n.textContent=e.ssid||"ZaaNet Network");let t=document.getElementById("networkLocation");if(t&&e.location){let o=[];e.location.city&&o.push(e.location.city),e.location.region&&o.push(e.location.region),e.location.country&&o.push(e.location.country),t.textContent=o.join(", ")||"Location not available"}let s=document.getElementById("networkRating");if(s){let o=e.averageRating??0,f=e.ratingCount??0;f>0?s.textContent=`${o.toFixed(1)} \u2B50 (${f} ${f===1?"review":"reviews"})`:s.textContent="0.0 \u2B50 (No reviews yet)"}let a=document.getElementById("hostName");if(a&&e.host){let o=typeof e.host=="object"&&e.host!==null?e.host.hostName:null;o&&(a.textContent=`Hosted by ${o}`)}let c=document.getElementById("networkInfo");c&&(c.style.display="block"),r("Network info displayed:",e)}async function j(e,n,t,s){let a=`${l.baseUrl}${l.startSessionEndpoint}`;r("POST",a);let c={voucherCode:e,contractId:n,deviceInfo:{userIP:t,userAgent:navigator.userAgent||"Unknown"}},o=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(!o.ok){let f=await o.json().catch(()=>({}));throw new Error(f.message||`HTTP ${o.status}: ${o.statusText}`)}return await o.json()}function w(e,n){!p||!u||(p.disabled=!e,p.textContent=n,u.disabled=!e)}function g(e,n){m&&(m.textContent=e,m.className=`message ${n}`,m.style.display="block",r(`[${n.toUpperCase()}]`,e))}function r(...e){i.features.enableLogging&&console.log("[ZaaNet]",...e)}function O(){return i.environment==="development"?"AA:BB:CC:DD:EE:FF":""}function F(){return i.environment==="development"?"192.168.8.100":""}function Z(e){return e.startsWith("$")}function R(e,n){return Z(e)?n:e}window.ndsToken=P,window.ndsRedir=$})();})();

(()=>{(function(){"use strict";let i=window.ZaaNetConfig||{environment:"production",features:{showDebugPanel:!1,autoFormatVoucher:!0,enableLogging:!0},voucher:{prefix:"ZNET",separator:"-",segments:3,segmentLength:4}},m=document.getElementById("voucherForm"),c=document.getElementById("voucherCode"),f=document.getElementById("submitBtn"),h=document.getElementById("message"),g=document.getElementById("debugPanel"),v=document.querySelector('meta[name="router-id"]')?.content||"UNKNOWN",u=document.querySelector('meta[name="contract-id"]')?.content||"UNKNOWN";if(!m||!c||!f){console.error("[ZaaNet] Required DOM elements not found");return}w();async function w(){if(o("Initializing ZaaNet Splash Page..."),o("Router ID:",v),o("Contract ID:",u),i.features.showDebugPanel&&g?g.style.display="block":g&&(g.style.display="none"),u&&u!=="UNKNOWN"&&u!=="CONTRACT_ID_PLACEHOLDER")try{await b(u)}catch(e){o("Failed to load network info:",e)}else o("Skipping network info load - invalid contract ID");I(),c?.focus(),E()}function I(){i.features.autoFormatVoucher&&c&&c.addEventListener("input",N),m&&m.addEventListener("submit",C)}function N(e){let n=e.target,t=n.value.toUpperCase();t=t.replace(/[^A-Z0-9]/g,"");let s=[];s.push(i.voucher.prefix),t.startsWith(i.voucher.prefix)&&(t=t.substring(i.voucher.prefix.length));for(let a=0;a<i.voucher.segments;a++){let d=a*i.voucher.segmentLength,r=t.substring(d,d+i.voucher.segmentLength);r&&s.push(r)}n.value=s.join(i.voucher.separator)}async function C(e){e.preventDefault();let n=c.value.trim();if(!n){l("Please enter a voucher code","error");return}y(!1,"Authorizing..."),l("Verifying voucher code\u2026","info");try{let t=await fetch("https://api.zaanet.xyz/api/v1/portal/sessions/start",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({voucher:n,mac:document.getElementById("clientMAC")?.value,ip:document.getElementById("clientIP")?.value,routerId:v,contractId:u})});if(!t.ok)throw new Error(`Server error (${t.status})`);let s=await t.json();if(s.success)l("Access granted. Connecting\u2026","success"),window.location.href="/ndsctl?cmd=auth";else throw new Error(s.message||"Invalid voucher")}catch(t){console.error(t),l(t.message||"Voucher verification failed","error"),y(!0,"Connect to Internet")}}function E(){let e=new URLSearchParams(window.location.search),n=e.get("auth"),t=e.get("error")||e.get("msg");n==="0"||n==="failed"?(o("Authentication failed - showing error"),l(t||"Invalid voucher code. Please try again.","error"),y(!0,"Connect to Internet")):(n==="1"||n==="success")&&(o("Authentication successful - redirecting to session"),l("Authentication successful! Redirecting...","success"),setTimeout(()=>{window.location.href="/session.html"},1e3))}async function b(e){o("Loading network info for contract:",e);try{o("Trying cached network-info.json...");let t=await fetch("/network-info.json",{cache:"no-cache",headers:{"Cache-Control":"no-cache"}});if(t.ok){let s=await t.json();if(o("Cached network info loaded:",s),s.success&&s.networkData){k(s.networkData),o("Network info displayed from cache");return}}else o("Cache response not OK:",t.status)}catch(t){o("Error loading cached network info:",t)}o("Network info loading failed - hiding section");let n=document.getElementById("networkInfo");n&&(n.style.display="none")}function k(e){o("Displaying network info:",e);let n=document.getElementById("networkInfo");n&&(n.style.display="block");let t=document.getElementById("networkName");t&&(t.textContent=e.ssid||"ZaaNet Network");let s=document.getElementById("networkLocation");if(s&&e.location){let r=[];e.location.city&&r.push(e.location.city),e.location.region&&r.push(e.location.region),e.location.country&&r.push(e.location.country),s.textContent=r.join(", ")||"Location not available"}let a=document.getElementById("networkRating");if(a){let r=e.averageRating??0,p=e.ratingCount??0;p>0?a.textContent=`${r.toFixed(1)} \u2B50 (${p} ${p===1?"review":"reviews"})`:a.textContent="0.0 \u2B50 (No reviews yet)"}let d=document.getElementById("hostName");if(d&&e.host){let r=typeof e.host=="object"&&e.host!==null?e.host.hostName:null;r&&(d.textContent=`Hosted by ${r}`)}o("Network info displayed successfully")}function y(e,n){!f||!c||(f.disabled=!e,f.textContent=n,c.disabled=!e)}function l(e,n){h&&(h.textContent=e,h.className=`message ${n}`,h.style.display="block",o(`[${n.toUpperCase()}]`,e))}function o(...e){i.features.enableLogging&&console.log("[ZaaNet]",...e)}})();})();

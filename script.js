"use strict";(()=>{(function(){"use strict";let i=window.ZaaNetConfig,R=i.getApiConfig(),I=document.getElementById("voucherForm"),a=document.getElementById("voucherCode"),f=document.getElementById("submitBtn"),g=document.getElementById("message"),p=document.getElementById("debugPanel"),k=document.getElementById("debugRouterID"),N=document.getElementById("debugContractID"),b=document.getElementById("debugMAC"),L=document.getElementById("debugIP"),M=document.getElementById("debugEnv"),T=document.getElementById("debugToken"),d=new URLSearchParams(window.location.search),C=d.get("tok")||"$tok",A=d.get("redir")||"$redir",P=d.get("mac")||d.get("clientmac")||"$clientmac",x=d.get("ip")||d.get("clientip")||"$clientip",h=B(P,Z()),y=B(x,j()),v=document.querySelector('meta[name="router-id"]')?.content||"UNKNOWN",l=document.querySelector('meta[name="contract-id"]')?.content||"UNKNOWN";if(!I||!a||!f||!g){console.error("[ZaaNet] Required DOM elements not found");return}H();async function H(){if(n("Initializing ZaaNet Splash Page..."),n("Environment:",i.environment),n("API Base URL:",R.baseUrl),n("Router ID:",v),n("Contract ID:",l),n("Client MAC:",h),n("Client IP:",y),i.features.showDebugPanel&&p?(p.style.display="block",k&&(k.textContent=v),N&&(N.textContent=l),b&&(b.textContent=h),L&&(L.textContent=y),M&&(M.textContent=i.environment),T&&(T.textContent=C)):p&&(p.style.display="none"),l&&l!=="UNKNOWN"&&l!=="CONTRACT_ID_PLACEHOLDER")try{await F(l)}catch(e){n("Failed to load network info:",e)}else n("Skipping network info load - invalid contract ID");$(),a?.focus()}function $(){i.features.autoFormatVoucher&&a&&a.addEventListener("input",U),I&&I.addEventListener("submit",S)}function U(e){let o=e.target,t=o.value.toUpperCase();t=t.replace(/[^A-Z0-9]/g,"");let s=[];s.push(i.voucher.prefix),t.startsWith(i.voucher.prefix)&&(t=t.substring(i.voucher.prefix.length));for(let c=0;c<i.voucher.segments;c++){let u=c*i.voucher.segmentLength,r=t.substring(u,u+i.voucher.segmentLength);r&&s.push(r)}o.value=s.join(i.voucher.separator)}async function S(e){if(e.preventDefault(),!a)return;let o=a.value.trim();if(!o){m("Please enter a voucher code","error");return}E(!1,"Authorizing..."),m("Authorizing access...","info");try{let t=new FormData;t.append("voucher",o),t.append("tok",C),t.append("redir",A),t.append("mac",h),t.append("ip",y),t.append("routerId",v),t.append("contractId",l);let c=await(await fetch("/cgi-bin/auth",{method:"POST",body:t})).text();if(c.includes("Auth: 1")){m("Access granted! Redirecting...","success");let u=`/session.html?mac=${encodeURIComponent(h)}&ip=${encodeURIComponent(y)}&voucher=${encodeURIComponent(o)}`;setTimeout(()=>{window.location.href=u},1e3)}else m("Authorization denied. Please check your voucher code.","error"),E(!0,"Connect to Internet"),n("Auth response:",c)}catch(t){n("Authorization error:",t),m("Authorization failed. Please try again.","error"),E(!0,"Connect to Internet")}}async function F(e){n("Loading network info for contract:",e);try{n("Trying cached network-info.json...");let t=await fetch("/network-info.json",{cache:"no-cache",headers:{"Cache-Control":"no-cache"}});if(t.ok){let s=await t.json();if(n("Cached network info loaded:",s),s.success&&s.networkData){O(s.networkData),n("Network info displayed from cache");return}}else n("Cache response not OK:",t.status)}catch(t){n("Error loading cached network info:",t)}n("All network info loading methods failed");let o=document.getElementById("networkInfo");o&&(o.style.display="none")}function O(e){n("Displaying network info:",e);let o=document.getElementById("networkInfo");o&&(o.style.display="block");let t=document.getElementById("networkName");t&&(t.textContent=e.ssid||"ZaaNet Network");let s=document.getElementById("networkLocation");if(s&&e.location){let r=[];e.location.city&&r.push(e.location.city),e.location.region&&r.push(e.location.region),e.location.country&&r.push(e.location.country),s.textContent=r.join(", ")||"Location not available"}let c=document.getElementById("networkRating");if(c){let r=e.averageRating??0,w=e.ratingCount??0;w>0?c.textContent=`${r.toFixed(1)} \u2B50 (${w} ${w===1?"review":"reviews"})`:c.textContent="0.0 \u2B50 (No reviews yet)"}let u=document.getElementById("hostName");if(u&&e.host){let r=typeof e.host=="object"&&e.host!==null?e.host.hostName:null;r&&(u.textContent=`Hosted by ${r}`)}n("Network info displayed successfully")}function E(e,o){!f||!a||(f.disabled=!e,f.textContent=o,a.disabled=!e)}function m(e,o){g&&(g.textContent=e,g.className=`message ${o}`,g.style.display="block",n(`[${o.toUpperCase()}]`,e))}function n(...e){i.features.enableLogging&&console.log("[ZaaNet]",...e)}function Z(){return i.environment==="development"?"AA:BB:CC:DD:EE:FF":""}function j(){return i.environment==="development"?"192.168.8.100":""}function z(e){return e.startsWith("$")}function B(e,o){return z(e)?o:e}window.ndsToken=C,window.ndsRedir=A})();})();

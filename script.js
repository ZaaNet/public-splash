"use strict";(()=>{(function(){"use strict";let i=window.ZaaNetConfig,u=i.getApiConfig(),E=document.getElementById("voucherForm"),l=document.getElementById("voucherCode"),h=document.getElementById("submitBtn"),m=document.getElementById("message"),I=document.getElementById("debugPanel"),C=document.getElementById("debugRouterID"),k=document.getElementById("debugContractID"),T=document.getElementById("debugMAC"),N=document.getElementById("debugIP"),b=document.getElementById("debugEnv"),R=document.getElementById("debugToken"),g=new URLSearchParams(window.location.search),P=g.get("tok")||"$tok",M=g.get("redir")||"$redir",B=g.get("mac")||g.get("clientmac")||"$clientmac",A=g.get("ip")||g.get("clientip")||"$clientip",y=$(B,D()),w=$(A,Z()),L=document.querySelector('meta[name="router-id"]')?.content||"UNKNOWN",d=document.querySelector('meta[name="contract-id"]')?.content||"UNKNOWN";if(!E||!l||!h||!m){console.error("[ZaaNet] Required DOM elements not found");return}x();async function x(){if(n("Initializing ZaaNet Splash Page..."),n("Environment:",i.environment),n("API Base URL:",u.baseUrl),n("Router ID:",L),n("Contract ID:",d),n("Client MAC:",y),n("Client IP:",w),i.features.showDebugPanel&&I?(I.style.display="block",C&&(C.textContent=L),k&&(k.textContent=d),T&&(T.textContent=y),N&&(N.textContent=w),b&&(b.textContent=i.environment),R&&(R.textContent=P)):I&&(I.style.display="none"),d&&d!=="UNKNOWN"&&d!=="CONTRACT_ID_PLACEHOLDER")try{await O(d)}catch(e){n("Failed to load network info:",e)}else n("Skipping network info load - invalid contract ID");H(),l?.focus()}function H(){i.features.autoFormatVoucher&&l&&l.addEventListener("input",U),E&&E.addEventListener("submit",V)}function U(e){let o=e.target,t=o.value.toUpperCase();t=t.replace(/[^A-Z0-9]/g,"");let s=[];s.push(i.voucher.prefix),t.startsWith(i.voucher.prefix)&&(t=t.substring(i.voucher.prefix.length));for(let a=0;a<i.voucher.segments;a++){let c=a*i.voucher.segmentLength,r=t.substring(c,c+i.voucher.segmentLength);r&&s.push(r)}o.value=s.join(i.voucher.separator)}async function V(e){if(e.preventDefault(),!l)return;let o=l.value.trim();if(!o){f("Please enter a voucher code","error");return}n("Validating voucher:",o),v(!1,"Validating..."),f("Validating your voucher...","info");try{let t=await j(o);if(!t.isValid){f(t.error||"Invalid voucher code","error"),v(!0,"Connect to Internet");return}n("Voucher valid!",t),f("Voucher valid! Starting session...","success");let s=await F(o,d,w,y);if(s.success&&s.sessionId&&s.contractId)f("Success! Loading your session...","success"),setTimeout(()=>{let a=s.sessionId||"",c=s.contractId||"",r=`session.html?sessionId=${encodeURIComponent(a)}&contractId=${encodeURIComponent(c)}&mac=${encodeURIComponent(y)}&ip=${encodeURIComponent(w)}`;n("Redirecting to session dashboard:",r),window.location.href=r},i.ui.redirectDelay);else throw new Error(s.message||"Failed to start session")}catch(t){n("Error:",t),f("Connection error. Please try again.","error"),v(!0,"Connect to Internet")}}async function j(e){let o=`${u.baseUrl}${u.validateEndpoint}`;n("POST",o);let t=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({voucherCode:e})});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);return await t.json()}async function O(e){n("Loading network info for contract:",e);try{n("Trying cached network-info.json...");let t=await fetch("/network-info.json",{cache:"no-cache",headers:{"Cache-Control":"no-cache"}});if(t.ok){let s=await t.json();if(n("Cached network info loaded:",s),s.success&&s.networkData){S(s.networkData),n("Network info displayed from cache");return}}else n("Cache response not OK:",t.status)}catch(t){n("Error loading cached network info:",t)}try{n("Trying API endpoint...");let t=`${u.baseUrl}${u.networkInfoEndpoint}/${e}`;n("GET",t);let s=await fetch(t,{method:"GET",headers:{"Content-Type":"application/json"}});if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);let a=await s.json();if(a.success&&a.networkData){S(a.networkData),n("Network info displayed from API");return}}catch(t){n("Error loading network info from API:",t)}n("All network info loading methods failed");let o=document.getElementById("networkInfo");o&&(o.style.display="none")}function S(e){n("Displaying network info:",e);let o=document.getElementById("networkInfo");o&&(o.style.display="block");let t=document.getElementById("networkName");t&&(t.textContent=e.ssid||"ZaaNet Network");let s=document.getElementById("networkLocation");if(s&&e.location){let r=[];e.location.city&&r.push(e.location.city),e.location.region&&r.push(e.location.region),e.location.country&&r.push(e.location.country),s.textContent=r.join(", ")||"Location not available"}let a=document.getElementById("networkRating");if(a){let r=e.averageRating??0,p=e.ratingCount??0;p>0?a.textContent=`${r.toFixed(1)} \u2B50 (${p} ${p===1?"review":"reviews"})`:a.textContent="0.0 \u2B50 (No reviews yet)"}let c=document.getElementById("hostName");if(c&&e.host){let r=typeof e.host=="object"&&e.host!==null?e.host.hostName:null;r&&(c.textContent=`Hosted by ${r}`)}n("Network info displayed successfully")}async function F(e,o,t,s){let a=`${u.baseUrl}${u.startSessionEndpoint}`;n("POST",a);let c={voucherCode:e,contractId:o,deviceInfo:{userIP:t,macAddress:s,userAgent:navigator.userAgent||"Unknown"}},r=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(!r.ok){let p=await r.json().catch(()=>({}));throw new Error(p.message||`HTTP ${r.status}: ${r.statusText}`)}return await r.json()}function v(e,o){!h||!l||(h.disabled=!e,h.textContent=o,l.disabled=!e)}function f(e,o){m&&(m.textContent=e,m.className=`message ${o}`,m.style.display="block",n(`[${o.toUpperCase()}]`,e))}function n(...e){i.features.enableLogging&&console.log("[ZaaNet]",...e)}function D(){return i.environment==="development"?"AA:BB:CC:DD:EE:FF":""}function Z(){return i.environment==="development"?"192.168.8.100":""}function q(e){return e.startsWith("$")}function $(e,o){return q(e)?o:e}window.ndsToken=P,window.ndsRedir=M})();})();

(()=>{(function(){"use strict";let i=window.ZaaNetConfig||{environment:"production",features:{showDebugPanel:!1,autoFormatVoucher:!0,enableLogging:!0},voucher:{prefix:"ZNET",separator:"-",segments:3,segmentLength:4}},y=document.getElementById("voucherForm"),a=document.getElementById("voucherCode"),h=document.getElementById("submitBtn"),g=document.getElementById("message"),m=document.getElementById("debugPanel"),p=document.querySelector('meta[name="router-id"]')?.content||"UNKNOWN",u=document.querySelector('meta[name="contract-id"]')?.content||"UNKNOWN";if(!y||!a||!h){console.error("[ZaaNet] Required DOM elements not found");return}I();async function I(){if(o("Initializing ZaaNet Splash Page..."),o("Router ID:",p),o("Contract ID:",u),i.features.showDebugPanel&&m?m.style.display="block":m&&(m.style.display="none"),u&&u!=="UNKNOWN"&&u!=="CONTRACT_ID_PLACEHOLDER")try{await b(u)}catch(e){o("Failed to load network info:",e)}else o("Skipping network info load - invalid contract ID");v(),a?.focus(),C()}function v(){i.features.autoFormatVoucher&&a&&a.addEventListener("input",N),y&&y.addEventListener("submit",E)}function N(e){let n=e.target,t=n.value.toUpperCase();t=t.replace(/[^A-Z0-9]/g,"");let s=[];s.push(i.voucher.prefix),t.startsWith(i.voucher.prefix)&&(t=t.substring(i.voucher.prefix.length));for(let r=0;r<i.voucher.segments;r++){let l=r*i.voucher.segmentLength,c=t.substring(l,l+i.voucher.segmentLength);c&&s.push(c)}n.value=s.join(i.voucher.separator)}async function E(e){e.preventDefault();let n=a.value.trim();if(!n){d("Please enter a voucher code","error");return}w(!1,"Authorizing..."),d("Verifying voucher code\u2026","info");try{let t=await fetch("https://api.zaanet.xyz/api/v1/portal/sessions/start",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({voucher:n,mac:document.getElementById("clientMAC")?.value,ip:document.getElementById("clientIP")?.value,routerId:p,contractId:u})});if(!t.ok)throw new Error(`Server error (${t.status})`);let s=await t.json();if(s.success)d("Access granted. Connecting\u2026","success"),window.location.href="/ndsctl?cmd=auth";else throw new Error(s.message||"Invalid voucher")}catch(t){console.error(t),d(t.message||"Voucher verification failed","error"),w(!0,"Connect to Internet")}}function C(){let e=new URLSearchParams(window.location.search),n=e.get("auth"),t=e.get("error")||e.get("msg");if(n==="1"||n==="success"){o("Authentication successful - redirecting to session"),d("Authentication successful! Redirecting...","success");let s=window.location.hostname,r=data.sessionId,l=document.getElementById("clientMAC")?.value||"",c=document.getElementById("clientIP")?.value||"",f=`/nds_auth/?authaction=authenticate&redir=http://${s}/session.html?sessionId=${r}&contractId=${u}&mac=${l}&ip=${c}`;setTimeout(()=>{window.location.href=f},1e3)}}async function b(e){o("Loading network info for contract:",e);try{o("Trying cached network-info.json...");let t=await fetch("/network-info.json",{cache:"no-cache",headers:{"Cache-Control":"no-cache"}});if(t.ok){let s=await t.json();if(o("Cached network info loaded:",s),s.success&&s.networkData){k(s.networkData),o("Network info displayed from cache");return}}else o("Cache response not OK:",t.status)}catch(t){o("Error loading cached network info:",t)}o("Network info loading failed - hiding section");let n=document.getElementById("networkInfo");n&&(n.style.display="none")}function k(e){o("Displaying network info:",e);let n=document.getElementById("networkInfo");n&&(n.style.display="block");let t=document.getElementById("networkName");t&&(t.textContent=e.ssid||"ZaaNet Network");let s=document.getElementById("networkLocation");if(s&&e.location){let c=[];e.location.city&&c.push(e.location.city),e.location.region&&c.push(e.location.region),e.location.country&&c.push(e.location.country),s.textContent=c.join(", ")||"Location not available"}let r=document.getElementById("networkRating");if(r){let c=e.averageRating??0,f=e.ratingCount??0;f>0?r.textContent=`${c.toFixed(1)} \u2B50 (${f} ${f===1?"review":"reviews"})`:r.textContent="0.0 \u2B50 (No reviews yet)"}let l=document.getElementById("hostName");if(l&&e.host){let c=typeof e.host=="object"&&e.host!==null?e.host.hostName:null;c&&(l.textContent=`Hosted by ${c}`)}o("Network info displayed successfully")}function w(e,n){!h||!a||(h.disabled=!e,h.textContent=n,a.disabled=!e)}function d(e,n){g&&(g.textContent=e,g.className=`message ${n}`,g.style.display="block",o(`[${n.toUpperCase()}]`,e))}function o(...e){i.features.enableLogging&&console.log("[ZaaNet]",...e)}})();})();
